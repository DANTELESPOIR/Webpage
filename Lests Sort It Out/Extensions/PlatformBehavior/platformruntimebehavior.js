var gdjs;(function(a){class o{constructor(e){this._platformRBush=new rbush(9,[".owner.getAABB().min[0]",".owner.getAABB().min[1]",".owner.getAABB().max[0]",".owner.getAABB().max[1]"])}static getManager(e){return e.platformsObjectsManager||(e.platformsObjectsManager=new a.PlatformObjectsManager(e)),e.platformsObjectsManager}addPlatform(e){this._platformRBush.insert(e)}removePlatform(e){this._platformRBush.remove(e)}getAllPlatformsAround(e,t,s){const g=e.getWidth(),l=e.getHeight(),h=e.getDrawableX()+e.getCenterX(),f=e.getDrawableY()+e.getCenterY(),i=a.staticObject(o.prototype.getAllPlatformsAround);i.minX=h-g/2-t,i.minY=f-l/2-t,i.maxX=h+g/2+t,i.maxY=f+l/2+t;const m=this._platformRBush.search(i);s.length=0,s.push.apply(s,m)}}a.PlatformObjectsManager=o;const r=class extends a.RuntimeBehavior{constructor(e,t,s){super(e,t,s);this._oldX=0;this._oldY=0;this._oldWidth=0;this._oldHeight=0;this._oldAngle=0;this._registeredInManager=!1;this._platformType=t.platformType,t.platformType==="Ladder"?this._platformType=r.LADDER:t.platformType==="Jumpthru"?this._platformType=r.JUMPTHRU:this._platformType=r.NORMALPLAFTORM,this._canBeGrabbed=t.canBeGrabbed||!1,this._yGrabOffset=t.yGrabOffset||0,this._manager=o.getManager(e)}updateFromBehaviorData(e,t){return e.platformType!==t.platformType&&this.changePlatformType(t.platformType),e.canBeGrabbed!==t.canBeGrabbed&&(this._canBeGrabbed=t.canBeGrabbed),e.yGrabOffset!==t.yGrabOffset&&(this._yGrabOffset=t.yGrabOffset),!0}onDestroy(){this._manager&&this._registeredInManager&&this._manager.removePlatform(this)}doStepPreEvents(e){!this.activated()&&this._registeredInManager?(this._manager.removePlatform(this),this._registeredInManager=!1):this.activated()&&!this._registeredInManager&&(this._manager.addPlatform(this),this._registeredInManager=!0),(this._oldX!==this.owner.getX()||this._oldY!==this.owner.getY()||this._oldWidth!==this.owner.getWidth()||this._oldHeight!==this.owner.getHeight()||this._oldAngle!==this.owner.getAngle())&&(this._registeredInManager&&(this._manager.removePlatform(this),this._manager.addPlatform(this)),this._oldX=this.owner.getX(),this._oldY=this.owner.getY(),this._oldWidth=this.owner.getWidth(),this._oldHeight=this.owner.getHeight(),this._oldAngle=this.owner.getAngle())}doStepPostEvents(e){}onActivate(){this._registeredInManager||(this._manager.addPlatform(this),this._registeredInManager=!0)}onDeActivate(){!this._registeredInManager||(this._manager.removePlatform(this),this._registeredInManager=!1)}changePlatformType(e){e==="Ladder"?this._platformType=r.LADDER:e==="Jumpthru"?this._platformType=r.JUMPTHRU:this._platformType=r.NORMALPLAFTORM}getPlatformType(){return this._platformType}canBeGrabbed(){return this._canBeGrabbed}getYGrabOffset(){return this._yGrabOffset}static isOnPlatformTest(e,t,s){return e.getBehavior(s).isOnFloorObject(t)}};let n=r;n.NORMALPLAFTORM=0,n.JUMPTHRU=1,n.LADDER=2,a.PlatformRuntimeBehavior=n,a.registerBehavior("PlatformBehavior::PlatformBehavior",a.PlatformRuntimeBehavior)})(gdjs||(gdjs={}));
//# sourceMappingURL=platformruntimebehavior.js.map
